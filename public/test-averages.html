<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Valeurs Moyennes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .result {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover { background: #2980b9; }
        .log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>üß™ Test Valeurs Moyennes</h1>
    <p>Test direct du syst√®me de valeurs nutritionnelles moyennes</p>
    
    <button onclick="testAverages()">üöÄ Test Calcul</button>
    
    <div id="result"></div>
    <div class="log" id="logs"></div>

    <script type="module">
        import { findNutritionData } from '/src/utils/externalNutritionAPI.js';
        
        // Intercepter console.log
        const originalLog = console.log;
        const originalWarn = console.warn;
        
        function addLog(message) {
            const logsDiv = document.getElementById('logs');
            logsDiv.innerHTML += message + '\n';
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '));
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addLog('‚ö†Ô∏è ' + args.join(' '));
        };
        
        window.testAverages = async function() {
            const resultDiv = document.getElementById('result');
            document.getElementById('logs').innerHTML = '';
            
            console.log('üß™ === TEST VALEURS MOYENNES ===\n');
            
            const ingredients = [
                "Flocons d'avoine",
                "Yaourt v√©g√©tal (coco)",
                "Lait d'amande",
                "Fruits frais (kiwi, fraises)",
                "Noix de cajou",
                "Graines de lin",
                "Miel"
            ];
            
            let html = '<h2>R√©sultats</h2>';
            
            for (const ing of ingredients) {
                console.log(`\nüîç Test: "${ing}"`);
                const data = await findNutritionData(ing);
                
                if (data) {
                    html += `
                        <div class="result">
                            <strong>${ing}</strong><br>
                            ‚úÖ Trouv√©: ${data.nom}<br>
                            üìä ${data.energie_kcal} kcal/100g | 
                            P: ${data.proteines_g}g | 
                            L: ${data.lipides_g}g | 
                            G: ${data.glucides_g}g<br>
                            <small>Source: ${data.source}</small>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="result" style="background: #ffebee;">
                            <strong>${ing}</strong><br>
                            ‚ùå NON TROUV√â
                        </div>
                    `;
                }
            }
            
            resultDiv.innerHTML = html;
            console.log('\n‚úÖ === FIN TEST ===');
        };
    </script>
</body>
</html>

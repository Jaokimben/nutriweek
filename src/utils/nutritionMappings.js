/**
 * Mappings pr√©cis entre noms d'ingr√©dients et codes CIQUAL
 * G√©n√©r√© depuis nutrition_mappings_export.csv
 * 264 mappings manuels pour une pr√©cision maximale
 */

export const NUTRITION_MAPPINGS = {
  // Herbes et √©pices
  'herbes de provence': '11060',
  '1c. √† caf√© herbes de provence': '11060',
  'basilic': '11033',
  'basilic s√©ch√©': '11032',
  'aneth frais': '11093',
  'persil': '11014',
  'persil frais': '11014',
  'ciboulette': '11003',
  'coriandre': '11094',
  'coriandre fra√Æche': '11094',
  'coriandre en poudre': '11026',
  'coriandre moulu': '11026',
  'menthe': '11027',
  'thym': '11038',
  'thym frais': '11070',
  'origan': '11035',
  'origan s√©ch√©': '11035',
  'cannelle': '11025',
  'cannelle en poudre': '11025',
  'cumin': '11042',
  'curcuma': '11089',
  'paprika': '11049',
  'safran': '11039',
  'gingembre': '11074',
  'gingembre moulu': '11006',
  'noix de muscade': '11048',
  'poivre': '11015',
  'poivre moulu': '11015',
  'poivre noir moulu': '11015',
  'piment de cayenne': '11088',
  'piment de cayenne (facultatif)': '11088',
  
  // L√©gumes
  'tomate': '20047',
  'tomates': '20047',
  'tomates cerises': '20172',
  'tomates concass√©es': '20048',
  'tomates concass√©es en conserve': '20048',
  'concentr√© de tomate': '20068',
  'concentr√© de tomates': '20068',
  'concentre de tomates': '20068',
  'pur√©e de tomates': '20170',
  'puree de tomates': '20170',
  'sauce tomate': '11107',
  'concombre': '20210',
  'courgette': '20020',
  'courgettes': '20020',
  'aubergine': '20002',
  'aubergines': '20002',
  'poivron': '20088',
  'poivrons': '20088',
  'poivron rouge': '20088',
  'poivron vert': '20086',
  'mini poivrons': '20088',
  'carotte': '20009',
  'carottes': '20009',
  'oignon': '20035',
  'oignons': '20035',
  'oignon rouge': '20324',
  '√©chalote': '20097',
  '√©chalotes': '20097',
  '√âchalote': '20255',
  'echalote': '20255',
  'ail': '11307',
  'd\'ail': '11307',
  'gousse d\'ail': '11000',
  'gousses d\'ail': '11307',
  'brocoli': '20006',
  'chou-fleur': '20016',
  'champignon': '20056',
  'champignons': '20056',
  'champignons de paris': '20125',
  'asperges': '20299',
  '√©pinard': '20336',
  '√©pinards': '20336',
  'haricot vert': '20030',
  'haricots verts': '20030',
  'c√©leri': '20023',
  'c√©leri branche': '20023',
  'navets': '20033',
  'potiron': '20332',
  'pomme de terre': '4002',
  'pommes de terre': '4002',
  'petits pois (frais ou surgel√©s)': '20326',
  
  // Salades
  'salade': '11020',
  'laitue': '11020',
  'salade romaine': '25604',
  'jeunes pousses de salade': '25604',
  
  // L√©gumineuses
  'lentille': '20505',
  'lentilles': '20505',
  'lentilles vertes': '20505',
  'pois chiche': '20532',
  'pois chiches': '20532',
  'haricot blanc': '20502',
  'haricots blancs': '20502',
  'haricot rouge': '20503',
  'haricots rouges': '20503',
  
  // C√©r√©ales et f√©culents
  'riz': '9104',
  'riz blanc': '9104',
  'riz complet': '9103',
  'riz √† sushi': '25088',
  'quinoa': '9341',
  'avoine': '32140',
  'flocons d\'avoine': '32140',
  'p√¢te': '9811',
  'p√¢tes': '9811',
  'p√¢tes semi compl√®tes': '9811',
  'spaghetti': '9811',
  'lasagne': '9811',
  'semoule': '9683',
  'couscous': '9683',
  'pain': '9000',
  'pain blanc': '7000',
  'pain complet': '7110',
  'pain de campagne': '7261',
  'pains burger': '7259',
  'p√¢te √† pizza': '96778',
  'tortillas de ma√Øs': '7813',
  'farine': '9440',
  'farine de bl√©': '9436',
  'farine de ble': '9436',
  'ma√Øzena': '9545',
  
  // Fruits
  'pomme': '13039',
  'pommes': '13039',
  'banane': '13005',
  'bananes': '13005',
  'orange': '13034',
  'oranges': '13034',
  'citron': '13009',
  'citrons': '13009',
  'citron vert': '13067',
  'kiwi': '13021',
  'kiwis': '13021',
  'fraise': '13014',
  'fraises': '13014',
  'avocat': '13004',
  'avocats': '13004',
  'poire': '13037',
  'poires': '13037',
  'p√™che': '13193',
  'p√™ches': '13193',
  'abricot': '13000',
  'abricots': '13000',
  'ananas frais': '13002',
  'raisins secs': '13046',
  
  // Fruits √† coque et graines
  'amandes': '15000',
  'amandes decortiquees': '15000',
  'amandes effilees et grillees': '15000',
  'amandes en poudre': '15000',
  'poudre d\'amandes': '15000',
  'noix': '15005',
  'noix m√©lang√©es (amandes, noisettes, noix de cajou)': '15005',
  'noix de coco rapee': '15007',
  'noix de coco r√¢p√©e': '15007',
  'graines (chia, lin, courge)': '15047',
  'graines de sesame': '15010',
  'graines de coriandre': '11026',
  'graines de cumin': '11042',
  
  // Viandes
  'poulet': '36004',
  'poulet entier': '36004',
  'blanc de poulet': '36018',
  'filets de poulet': '36018',
  'dinde': '36306',
  'filet de dinde': '28964',
  'boeuf': '6151',
  'b≈ìuf': '6151',
  'viande de b≈ìuf': '6255',
  'boeuf hach√©': '6255',
  'steak hach√©': '6255',
  'viande hachee': '6255',
  'viande hach√©e': '6255',
  'viande hach√©e de boeuf': '6255',
  'entrec√¥te': '6100',
  'porc': '28205',
  'viande de porc': '28205',
  'veau': '6563',
  'agneau': '21503',
  'jambon': '28919',
  'jambon blanc': '28800',
  'saucisse': '30780',
  'saucisses': '30780',
  
  // Poissons et fruits de mer
  'saumon': '25996',
  'saumon frais': '26036',
  'saumon fum√©': '26037',
  'pav√©s de saumon': '25996',
  'thon': '26179',
  'cabillaud': '25997',
  'truite fum√©e': '27029',
  'filet de truite': '27006',
  'sardine': '26034',
  'sardines': '26034',
  'bar': '27030',
  'filet de bar': '26205',
  'foie de morue fum√©': '26142',
  'crevette': '10007',
  'crevettes': '10007',
  
  // Produits laitiers
  'lait': '19041',
  'lait entier': '19023',
  'cr√®me': '19040',
  'cr√®me fra√Æche': '19410',
  'creme fraiche': '19410',
  'cr√®me fra√Æche √©paisse': '19410',
  'cr√®me liquide': '19415',
  'beurre': '16400',
  'beurre (pour le moule)': '16400',
  'yaourt': '19599',
  'yaourt nature': '19593',
  'yaourt grec': '19860',
  'fromage blanc': '19646',
  'fromage': '12115',
  'emmental': '12115',
  'fromage r√¢p√©': '12118',
  'parmesan': '12120',
  'parmesan en copeaux': '12120',
  'parmesan r√¢p√©': '12120',
  'mozzarella': '19590',
  'mozzarella r√¢p√©e': '19590',
  'feta': '12061',
  'camembert': '12006',
  'fromage de ch√®vre': '12800',
  'fromage cheddar': '12726',
  'fromage √† tartiner': '12300',
  'lait de coco': '18041',
  
  // ≈íufs
  'oeuf': '22000',
  'oeufs': '22000',
  '≈ìuf': '22000',
  '≈ìufs': '22000',
  
  // Huiles et mati√®res grasses
  'huile': '17000',
  'huile d\'olive': '17270',
  'huile d\'olive': '17270',
  'huile de colza': '17130',
  'huile de tournesol': '17440',
  'huile de coco': '16040',
  
  // Condiments et sauces
  'moutarde': '11013',
  'moutarde de dijon': '11013',
  'vinaigre de riz': '11018',
  'vinaigre de xeres': '11220',
  'sauce soja': '11104',
  'capre au vinaigre': '11040',
  'olives vertes': '13033',
  
  // Sucres et produits sucr√©s
  'sucre': '31016',
  'sucre blanc': '31016',
  'sucre en poudre': '31016',
  'cassonade': '31017',
  'miel': '31008',
  'confiture': '31006',
  'chocolat noir': '31005',
  'chocolat patissier': '31005',
  'pepites de chocolat': '31005',
  'p√©pites de chocolat': '31005',
  
  // Bouillons et bases
  'bouillon de l√©gumes': '25948',
  'bouillon de volaille': '25947',
  'bouillon de boeuf': '25930',
  'eau': '18000',
  
  // Divers
  'sel': '11017',
  'gros sel': '11096',
  'levure chimique': '11046',
  'levure boulangere': '11045',
  'chapelure': '7500',
  'feuilles de nori': '20987',
  'compote de pommes sans sucre': '13109',
  'jus de citron': '2007',
  'jus d\'orange': '2013',
  'vin rouge': '5214'
};

/**
 * Normalise le nom d'un ingr√©dient pour le mapping
 * @param {string} ingredientName - Nom de l'ingr√©dient
 * @returns {string} - Nom normalis√©
 */
export const normalizeIngredientName = (ingredientName) => {
  if (!ingredientName) return '';
  
  return ingredientName
    .toLowerCase()
    .trim()
    // Enlever les articles
    .replace(/^(le|la|les|l'|un|une|des|du|de la|de l')\s+/i, '')
    // Enlever les quantit√©s
    .replace(/^\d+\s*(g|kg|ml|cl|l|c\.|c\.√†|cuill√®re|cuill√®res|pinc√©e|gousse|gousses|tranche|tranches)?\s*/i, '')
    // Enlever les parenth√®ses et leur contenu
    .replace(/\s*\([^)]*\)/g, '')
    // Enlever les indications finales
    .replace(/\s*(cru|crue|cuit|cuite|frais|fra√Æche|s√©ch√©|s√©ch√©e|r√¢p√©|r√¢p√©e|hach√©|hach√©e|en poudre|en d√©s)$/i, '')
    .trim();
};

/**
 * Trouve le code CIQUAL pour un ingr√©dient
 * @param {string} ingredientName - Nom de l'ingr√©dient
 * @returns {string|null} - Code CIQUAL ou null si non trouv√©
 */
export const findCiqualCodeFromMapping = (ingredientName) => {
  if (!ingredientName) return null;
  
  // Normaliser le nom
  const normalized = normalizeIngredientName(ingredientName);
  
  // Recherche exacte
  if (NUTRITION_MAPPINGS[normalized]) {
    console.log(`‚úÖ [Mapping] Trouv√© exact: "${ingredientName}" ‚Üí code ${NUTRITION_MAPPINGS[normalized]}`);
    return NUTRITION_MAPPINGS[normalized];
  }
  
  // Recherche avec le nom original
  const originalLower = ingredientName.toLowerCase().trim();
  if (NUTRITION_MAPPINGS[originalLower]) {
    console.log(`‚úÖ [Mapping] Trouv√© original: "${ingredientName}" ‚Üí code ${NUTRITION_MAPPINGS[originalLower]}`);
    return NUTRITION_MAPPINGS[originalLower];
  }
  
  // Recherche partielle (si l'ingr√©dient contient un mot-cl√©)
  for (const [key, code] of Object.entries(NUTRITION_MAPPINGS)) {
    if (normalized.includes(key) || key.includes(normalized)) {
      console.log(`‚úÖ [Mapping] Trouv√© partiel: "${ingredientName}" ‚âà "${key}" ‚Üí code ${code}`);
      return code;
    }
  }
  
  console.log(`‚ö†Ô∏è [Mapping] Non trouv√©: "${ingredientName}" (normalis√©: "${normalized}")`);
  return null;
};

/**
 * Obtient tous les codes CIQUAL disponibles dans les mappings
 * @returns {Array<string>} - Liste des codes CIQUAL
 */
export const getAllMappedCiqualCodes = () => {
  return [...new Set(Object.values(NUTRITION_MAPPINGS))];
};

/**
 * Statistiques sur les mappings
 */
export const getMappingStats = () => {
  const uniqueCodes = getAllMappedCiqualCodes();
  return {
    totalMappings: Object.keys(NUTRITION_MAPPINGS).length,
    uniqueCiqualCodes: uniqueCodes.length,
    mappingsPerCode: (Object.keys(NUTRITION_MAPPINGS).length / uniqueCodes.length).toFixed(2)
  };
};

console.log('üìö [Mappings] Charg√©:', getMappingStats());
